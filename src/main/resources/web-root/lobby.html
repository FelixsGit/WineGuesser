<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{resources/fragments/layout}">
<head>
    <meta charset="UTF-8">
    <title>Wine Guesser</title>
</head>

<body>
<main layout:fragment="content">

    <h2>Detta är en öppen lobby med koden:</h2>
    <br>
    <h1 th:text="${lobbyForm.gameId}"></h1>
    <br>
    <br>

    <form id="messageForm" name="messageForm" nameForm="messageForm" action="#">
        <button type="submit" th:id="${lobbyForm.username} + 'button'">Redo</button>
    </form>
    <br>



    <div id="ready-or-not">
        <div id="not-ready-page">
            <h2>Inte Redo</h2>
            <ul id="not-ready-area" th:each="lobbyData : *{lobbyForm.participantsNotReady}">
                <li th:id="${lobbyData.getParticipants()}" th:text="${lobbyData.getParticipants()}"></li>
            </ul>
        </div>

        <div id="ready-page">
            <h2>Redo</h2>
            <ul id="ready-area" th:each="lobbyData : *{lobbyForm.participantsReady}">
                <li th:id="${lobbyData.getParticipants()}" th:text="${lobbyData.getParticipants()}"></li>
            </ul>
            <ul id="ready-area" th:if="${lobbyForm.participantsReady.size() == 0}">

            </ul>
        </div>
    </div>
    <br>
    <form id="startGame" th:if="${lobbyForm.gameHost}" action="#">
        <button type="submit">Start Spel</button>
    </form>
    <br>
    <div th:if="${lobbyForm.gameHost}">
        <form id="lobbyClose" th:action="@{'/lobby/' + ${lobbyForm.gameId} + '/command/quit'}">
            <button type="submit">Stäng Lobby</button>
        </form>
    </div>
    <div th:unless="${lobbyForm.gameHost}">
        <form id="lobbyLeave" th:action="@{'/lobby/' + ${lobbyForm.gameId} + '/command/leave'}">
            <button type="submit">Lämna Lobby</button>
        </form>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            connect();
        });

        window.onbeforeunload = function() {
            return stompClientReg.send("/app/chat.regularComs/"+gameId,
                {},
                JSON.stringify({sender: username, content: 'specific socket communication', gameId: gameId, type: 'LEAVE'})
            )
        //if we return nothing here (just calling return;) then there will be no pop-up question at all
        //return;

        };
    </script>
</main>

</body>
</html>